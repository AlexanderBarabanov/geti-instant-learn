<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vision Prompt UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#3b82f6",
            secondary: "#6b7280",
          },
        },
      },
    };
  </script>
</head>

<body class="bg-gray-100 text-gray-800 font-sans p-8">
  <div class="bg-white p-6 rounded-lg shadow-md">
    <h1 class="text-3xl font-bold mb-4 text-primary">
      Vision Prompt UI
    </h1>

    <div class="flex justify-between items-start mb-6 gap-6">
      <div class="intro-text space-y-2 text-gray-600 flex-grow">
        <p>
          Welcome! This tool allows you to experiment with different visual
          prompting pipelines. Select a Pipeline, Backbone model, Dataset, and
          Class Name below. Choose the number of reference images (N-Shot) and
          configure parameters like Background Points. Click "Run" to process
          the target images. Results, including generated masks and similarity
          maps, will appear below.
        </p>
        <p>
          <strong>Interaction Tip:</strong> In the results section, click on
          the Used Foreground Points displayed on the target images to toggle
          the visibility of the corresponding segmentation mask.
        </p>
      </div>
      <div id="legend-container"
        class="p-4 border border-gray-200 rounded-md bg-gray-50 text-sm inline-block flex-shrink-0">
        <h4 class="font-semibold text-gray-700 mb-2">Point Legend:</h4>
        <div class="flex flex-col gap-y-1">
          <div class="flex items-center">
            <span class="w-3 h-3 inline-block mr-2 rounded-full border border-gray-400"
              style="background-color: rgba(50, 205, 50, 1);"></span>
            <span>Used Foreground Point</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 inline-block mr-2 rounded-full border border-gray-400"
              style="background-color: rgba(135, 206, 250, 1);"></span>
            <span>All Foreground Point</span>
          </div>
          <div class="flex items-center">
            <span class="w-3 h-3 inline-block mr-2 border border-gray-400"
              style="background-color: rgba(255, 0, 0, 1);"></span>
            <span>Background Point</span>
          </div>
        </div>
      </div>
    </div>

    <div class="controls-container mb-6 p-4 border border-gray-200 rounded-md bg-gray-50">
      <div
        class="controls-row grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-4 items-end">
        <div class="control-item flex flex-col">
          <label for="pipelineSelect" class="block text-sm font-medium text-gray-700 mb-1">Pipeline:</label>
          <select id="pipelineSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            {% for name in pipelines %}
            <option value="{{ name }}" {% if loop.first %}selected{% endif %}>
              {{ name }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="control-item flex flex-col">
          <label for="samNameSelect" class="block text-sm font-medium text-gray-700 mb-1">Backbone:</label>
          <select id="samNameSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            {% for name in sam_names %}
            <option value="{{ name }}" {% if name==default_sam_name %}selected{% endif %}>
              {{ name }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="control-item flex flex-col">
          <label for="datasetSelect" class="block text-sm font-medium text-gray-700 mb-1">Dataset:</label>
          <select id="datasetSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            {% for name in datasets %}
            <option value="{{ name }}" {% if name=="PerSeg" %}selected{% endif %}>
              {{ name }}
            </option>
            {% endfor %}
          </select>
        </div>
        <div class="control-item flex flex-col">
          <label for="classNameSelect" class="block text-sm font-medium text-gray-700 mb-1">Class Name:</label>
          <select id="classNameSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            <option value="" disabled selected>
              Select Dataset First...
            </option>
          </select>
        </div>
        <div class="control-item flex flex-col hidden" id="numTargetImagesControl">
          <label for="numTargetImagesInput" class="block text-sm font-medium text-gray-700 mb-1">Number of Target
            Images:
            <span id="numTargetImagesValue" class="font-normal"></span>/<span id="maxTargetImagesValue"
              class="font-normal"></span></label>
          <input type="range" id="numTargetImagesInput" value="1" min="1" max="1" step="1"
            class="mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 focus:outline-none focus:ring-0 focus:shadow-none" />
        </div>
        <div class="control-item flex flex-col">
          <label for="nShotInput" class="block text-sm font-medium text-gray-700 mb-1">N-Shot:</label>
          <input type="number" id="nShotInput" value="1" min="1"
            class="mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md" />
        </div>
        <div class="control-item flex flex-col">
          <label for="numBackgroundPointsInput" class="block text-sm font-medium text-gray-700 mb-1">Background
            Points:</label>
          <input type="number" id="numBackgroundPointsInput" value="2" min="0"
            class="mt-1 block w-full pl-3 pr-3 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md" />
        </div>
        <div class="control-item flex flex-col">
          <label for="similarityThresholdInput" class="block text-sm font-medium text-gray-700 mb-1">Point Similarity
            Threshold: <span id="similarityThresholdValue" class="font-normal">0.65</span></label>
          <input type="range" id="similarityThresholdInput" value="0.65" min="0" max="1" step="0.01"
            class="mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 focus:outline-none focus:ring-0 focus:shadow-none" />
        </div>
        <div class="control-item flex flex-col">
          <label for="maskSimilarityThresholdInput" class="block text-sm font-medium text-gray-700 mb-1">Mask Similarity
            Threshold: <span id="maskSimilarityThresholdValue" class="font-normal">0.42</span></label>
          <input type="range" id="maskSimilarityThresholdInput" value="0.42" min="0" max="1" step="0.01"
            class="mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 focus:outline-none focus:ring-0 focus:shadow-none" />
        </div>
        <div class="control-item flex flex-col">
          <label for="precisionSelect" class="block text-sm font-medium text-gray-700 mb-1">Precision:</label>
          <select id="precisionSelect"
            class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
            <option value="float" {% if precision=="float" %}selected{% endif %}>float</option>
            <option value="float16" {% if precision=="float16" %}selected{% endif %}>float16</option>
            <option value="bfloat16" {% if precision=="bfloat16" %}selected{% endif %}>bfloat16</option>
          </select>
        </div>
        <div class="control-item flex flex-col">
          <div class="flex items-center space-x-2 pt-5">
            <input type="checkbox" id="compileModelsCheckbox" name="compileModelsCheckbox"
              class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" {% if compile_models %}checked{%
              endif %}>
            <label for="compileModelsCheckbox" class="font-medium text-gray-700">Compile models</label>
          </div>
        </div>
        <div class="control-item flex flex-col">
          <div class="flex items-center space-x-2 pt-5">
            <input type="checkbox" id="skipPointsInExistingMasks" name="skipPointsInExistingMasks"
              class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded" checked>
            <label for="skipPointsInExistingMasks" class="font-medium text-gray-700">Skip covered points</label>
          </div>
        </div>
        <div class="control-item flex flex-col">
          <div class="flex items-center space-x-2 pt-5">
            <input id="randomPriorCheckbox" name="randomPriorCheckbox" type="checkbox"
              class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
            <label for="randomPriorCheckbox" class="font-medium text-gray-700">Use random references</label>
          </div>
        </div>
        <div class="control-item run-button-item flex flex-col justify-end">
          <div class="flex gap-2 items-center">
            <button id="runButton"
              class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
              Run
            </button>
          </div>
        </div>
      </div>
    </div>

    <div id="progress-container" class="mb-6 hidden relative">
      <div class="w-full bg-gray-200 rounded-full h-4 dark:bg-gray-700">
        <div id="progress-bar-fill" class="bg-primary h-4 rounded-full text-center text-white text-xs leading-none"
          style="width: 0%"></div>
      </div>
      <p id="progress-text" class="absolute inset-0 flex items-center justify-center text-xs font-medium text-white"
        style="text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);">
      </p>
    </div>

    <div id="reference-container" class="mb-6">
    </div>

    <div id="results-container"
      class="results-container mt-6 grid grid-cols-[repeat(auto-fit,minmax(500px,1fr))] gap-6"></div>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>

</html>